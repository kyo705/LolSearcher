<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<title th:text="${summoner.name}+ ' - 인게임 정보'"></title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="/css/style_summoner.css" type="text/css"> 
	</head>
	<body>
		<script>
			/*var champions;
			
			function readTextFile(file, callback) {
			    var rawFile = new XMLHttpRequest();
			    rawFile.overrideMimeType("application/json");
			    rawFile.open("GET", file, true);
			    rawFile.onreadystatechange = function() {
			        if (rawFile.readyState === 4 && rawFile.status == "200") {
			            callback(rawFile.responseText);
			        }
			    }
			    rawFile.send(null);
			    
			}
			
			readTextFile("/json/champion.json", function(text){
				var champJsonData = JSON.parse(text);
				champions = champJsonData.data;
			});*/
			
			var champJsonData = fetch("./json/champion.json")
			.then(response => {
				return response.json();
			})
			.then(jsondata => console.log(jsondata));
				
			var champions = champJsonData.data;
			
			function findChampName(champid){
				console.log(champid);
				var champs = champions;
				console.log(champJsonData);
				for(champion in champs) {
					var champ = champs[champion];
					console.log(champ);
					if(champ.key===champid) {
						return champ.id;

					}
				}		
			}
			
		</script>
		<h1 class="head">
			<a href="/">LOL Searcher</a>
		</h1>
		<div class="same_row">
			<div>
				<form name="champions" action ="/champions"  method="POST">
					<button type="submit">챔피언 분석</button>
				</form>
			</div>
			<div>
				<form name="summoner" action ="/summoner" method="POST">
					<input type="text" name="name" placeholder="소환사 이름 검색 입력">
					<button type="submit">검색</button>
				</form>
			</div>
		</div>
		<div class="same_row">
			<img style="padding: 10px 10px;" th:src="'/profileicon/'+${summoner.profileIconId}+'.png'" height="90" width="80"/>
			<div style="padding: 6px 12px;">
				<div style="font-size:x-large;" th:text="${summoner.name}"></div>
				<div style="font-size:large;" th:text="'Level : '+ ${summoner.summonerLevel}"></div>
			</div>
		</div>
		<div>
			<div class="same_row">
				<div th:text="${ingame.gameId}"/>
				<div th:text="${ingame.gameType}"/>
				<div th:text="${ingame.gameStartTime}"/>
				<div th:text="${ingame.gameMode}"/>
			</div>
			<div class="same_row" th:each="participant : ${ingame.participants}">
				<script th:inline="javascript">
					console.log(champions);
				    /*<![CDATA[*/
				    
				    var champId = "[[${participant.championId}]]";

				    /*]]>*/
				    
				    var champInfo = findChampName(champId);
					document.write('<img src="/champion/'+champInfo+'.png" width="50"/>');
				</script>
				<div th:text="${participant.summonerName}"/>
				<div th:text="${participant.spell1Id}"/>
				<div th:text="${participant.spell2Id}"/>
			</div>
			<div class="same_row" th:each="participant2 : ${ingame.participants}">
				<script th:inline="javascript">
					console.log(champions);
				    /*<![CDATA[*/
				    
				    var champId = "[[${participant2.championId}]]";
	
				    /*]]>*/
				    
				    var champInfo = findChampName(champId);
					document.write('<img src="/champion/'+champInfo+'.png" width="50"/>');
				</script>
				<div th:text="${participant2.summonerName}"/>
				<div th:text="${participant2.spell1Id}"/>
				<div th:text="${participant2.spell2Id}"/>
			</div>
		</div>
	</body>
</html>